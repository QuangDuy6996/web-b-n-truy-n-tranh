<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MangaXYZ - Chi tiết Đơn hàng</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
    .product-image{width:80px;height:120px;object-fit:cover;border-radius:6px}
    body{background:#f3f4f6}
    .card-ghost{box-shadow:0 8px 20px rgba(15,23,42,0.06);border-radius:10px}
</style>
</head>
<body>
<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Chi tiết Đơn hàng <span id="order-id-display">#...</span></h2>
        <a href="admin.html" class="btn btn-secondary"><i class="fas fa-arrow-left me-2"></i>Quay lại</a>
    </div>
    <div class="row mb-4">
        <div class="col-md-4"><div class="card card-ghost p-3"><h6>Khách hàng</h6><p id="customer-info"></p><p id="customer-email" class="text-muted"></p></div></div>
        <div class="col-md-4"><div class="card card-ghost p-3"><h6>Ngày đặt</h6><p id="date-info"></p></div></div>
        <div class="col-md-4"><div class="card card-ghost p-3"><h6>Địa chỉ</h6><p id="address-info"></p></div></div>
    </div>

    <div class="card card-ghost">
        <div class="card-header bg-dark text-white"><h6 class="mb-0">Các Sản phẩm</h6></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead class="table-light"><tr><th>Ảnh</th><th>Tên</th><th>Giá</th><th>Số lượng</th><th>Tổng</th></tr></thead>
                    <tbody id="order-items-table"></tbody>
                </table>
            </div>
        </div>
        <div class="card-footer text-end"><h5 class="mb-0">Tổng cộng: <span id="total-amount">0 VNĐ</span></h5></div>
    </div>
    <div class="mt-3 text-end">
        <button class="btn btn-info me-2"><i class="fas fa-truck me-2"></i>Chuyển sang Đang giao</button>
        <button class="btn btn-success"><i class="fas fa-check me-2"></i>Đánh dấu Hoàn thành</button>
    </div>
</div>

<script>
// load order detail using mock data from localStorage: we will embed minimal mock data here for robustness
(function(){
    // Basic fallback mock data (used only if admin-script.js is not available)
    const fallbackOrders = [
        { id: 'DH001', customer: 'Nguyễn Văn A', date: '2025-11-01', address: '123 Đường A, Quận 1, TP. HCM' }
    ];
    const fallbackOrderItems = [
        { id: 'DH001', items: [{ name:'Sample', price:100000, quantity:1, image:'https://via.placeholder.com/80x120' }] }
    ];

    const orderId = localStorage.getItem('currentOrderId');
    if (!orderId) {
        document.getElementById('order-id-display').textContent = 'Không tìm thấy ID đơn hàng.';
        return;
    }
    // Try to read mockOrders and mockOrderItems from opener window (if opened by admin), otherwise use fallback
    let orderData = null;
    let orderItems = null;
    try {
        // If this page was opened from admin.html in same tab, mock data is not accessible; so check localStorage
        const stored = localStorage.getItem('mockOrders_json');
        const storedItems = localStorage.getItem('mockOrderItems_json');
        if (stored) {
            const mockOrders = JSON.parse(stored);
            orderData = mockOrders.find(o=>o.id===orderId);
        }
        if (storedItems) {
            const mockOrderItems = JSON.parse(storedItems);
            orderItems = (mockOrderItems.find(oi=>oi.id===orderId) || {}).items;
        }
    } catch(e){
        console.warn('Loi doc mock tu localStorage', e);
    }

    if (!orderData) orderData = fallbackOrders.find(o=>o.id===orderId) || fallbackOrders[0];
    if (!orderItems) orderItems = (fallbackOrderItems.find(oi=>oi.id===orderId) || {}).items || fallbackOrderItems[0].items;

    document.getElementById('order-id-display').textContent = '#' + orderId;
    document.getElementById('customer-info').textContent = orderData.customer || '';
    document.getElementById('customer-email').textContent = (orderData.customer || '').replace(/\s/g,'').toLowerCase() + '@email.com';
    document.getElementById('date-info').textContent = orderData.date || '';
    document.getElementById('address-info').textContent = orderData.address || '';

    let total=0;
    const tbody = document.getElementById('order-items-table');
    tbody.innerHTML = '';
    orderItems.forEach(it=>{
        const itemTotal = (it.price||0)*(it.quantity||1);
        total += itemTotal;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><img src="${it.image}" class="product-image" alt=""></td>
                        <td>${it.name}</td>
                        <td>${(it.price||0).toLocaleString('vi-VN')} VNĐ</td>
                        <td>${it.quantity||1}</td>
                        <td>${itemTotal.toLocaleString('vi-VN')} VNĐ</td>`;
        tbody.appendChild(tr);
    });
    document.getElementById('total-amount').textContent = total.toLocaleString('vi-VN') + ' VNĐ';
})();
</script>
</body>
</html>
